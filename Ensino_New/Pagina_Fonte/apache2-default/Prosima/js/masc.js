(function(d){var x,y=function(){var g=document.createElement("input");return g.setAttribute("onpaste",""),"function"==typeof g.onpaste?"paste":"input"}()+".mask",q=navigator.userAgent,z=/iphone/i.test(q),A=/android/i.test(q);d.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"};d.fn.extend({caret:function(g,h){var d;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof g?(h="number"==typeof h?h:g,this.each(function(){this.setSelectionRange?this.setSelectionRange(g,
h):this.createTextRange&&(d=this.createTextRange(),d.collapse(!0),d.moveEnd("character",h),d.moveStart("character",g),d.select())})):(this[0].setSelectionRange?(g=this[0].selectionStart,h=this[0].selectionEnd):document.selection&&document.selection.createRange&&(d=document.selection.createRange(),g=0-d.duplicate().moveStart("character",-1E5),h=g+d.text.length),{begin:g,end:h})},unmask:function(){return this.trigger("unmask")},mask:function(g,h){var q,u,k,n,p,m;return!g&&0<this.length?(q=d(this[0]),
q.data(d.mask.dataName)()):(h=d.extend({placeholder:d.mask.placeholder,completed:null},h),u=d.mask.definitions,k=[],n=m=g.length,p=null,d.each(g.split(""),function(d,h){"?"==h?(m--,n=d):u[h]?(k.push(RegExp(u[h])),null===p&&(p=k.length-1)):k.push(null)}),this.trigger("unmask").each(function(){function r(b){for(;m>++b&&!k[b];);return b}function q(b,a){var c,e;if(!(0>b)){c=b;for(e=r(a);m>c;c++)if(k[c]){if(!(m>e&&k[c].test(l[e])))break;l[c]=l[e];l[e]=h.placeholder;e=r(e)}s();f.caret(Math.max(p,b))}}function B(b){var a,
c,e=b.which;if(8===e||46===e||z&&127===e){a=f.caret();c=a.begin;a=a.end;if(0===a-c){if(46!==e)for(;0<=--c&&!k[c];);else c=a=r(c-1);a=46===e?r(a):a}v(c,a);q(c,a-1);b.preventDefault()}else 27==e&&(f.val(w),f.caret(0,t()),b.preventDefault())}function C(b){var a,c,e;c=b.which;a=f.caret();if(!(b.ctrlKey||b.altKey||b.metaKey||32>c)&&c){0!==a.end-a.begin&&(v(a.begin,a.end),q(a.begin,a.end-1));a=r(a.begin-1);if(m>a&&(c=String.fromCharCode(c),k[a].test(c))){var g,n,p;g=a;for(n=h.placeholder;m>g;g++)if(k[g]){if(e=
r(g),p=l[g],l[g]=n,!(m>e&&k[e].test(p)))break;n=p}l[a]=c;s();e=r(a);A?setTimeout(d.proxy(d.fn.caret,f,e),0):f.caret(e);h.completed&&e>=m&&h.completed.call(f)}b.preventDefault()}}function v(b,a){var c;for(c=b;a>c&&m>c;c++)k[c]&&(l[c]=h.placeholder)}function s(){f.val(l.join(""))}function t(b){var a,c,e=f.val(),d=-1;for(pos=a=0;m>a;a++)if(k[a]){for(l[a]=h.placeholder;pos++<e.length;)if(c=e.charAt(pos-1),k[a].test(c)){l[a]=c;d=a;break}if(pos>e.length)break}else l[a]===e.charAt(pos)&&a!==n&&(pos++,d=
a);return b?s():n>d+1?(f.val(""),v(0,m)):(s(),f.val(f.val().substring(0,d+1))),n?a:p}var f=d(this),l=d.map(g.split(""),function(b){return"?"!=b?u[b]?h.placeholder:b:void 0}),w=f.val();f.data(d.mask.dataName,function(){return d.map(l,function(b,a){return k[a]&&b!=h.placeholder?b:null}).join("")});f.attr("readonly")||f.one("unmask",function(){f.unbind(".mask").removeData(d.mask.dataName)}).bind("focus.mask",function(){clearTimeout(x);var b;w=f.val();b=t();x=setTimeout(function(){s();b==g.length?f.caret(0,
b):f.caret(b)},10)}).bind("blur.mask",function(){t();f.val()!=w&&f.change()}).bind("keydown.mask",B).bind("keypress.mask",C).bind(y,function(){setTimeout(function(){var b=t(!0);f.caret(b);h.completed&&b==f.val().length&&h.completed.call(f)},0)});t()}))}})})(jQuery);